<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>class nbla::VirtualCachingAllocatorBase &mdash; Neural Network Libraries 1.25.0 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="class nbla::WarpByFlow" href="nbla--WarpByFlow.html" />
    <link rel="prev" title="class nbla::VirtualCachingAllocator" href="nbla--VirtualCachingAllocator.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> Neural Network Libraries
          </a>
              <div class="version">
                1.25.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../python.html">Python Package</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../cpp.html">C++ API</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../installation.html">Build C++ libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../command_line_interface.html">C++ Command Line Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples.html">C++ API Examples</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../doc.html">C++ API Document</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../../cpp_api.html">NNABLA C++ API Document</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="../class.html">NNABLA Class</a></li>
<li class="toctree-l4"><a class="reference internal" href="../struct.html">NNABLA Struct</a></li>
<li class="toctree-l4"><a class="reference internal" href="../namespace.html">NNABLA Namespace</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../data_exchange_file_format.html">Data exchange file format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../format.html">Data Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../python/file_format_converter/file_format_converter.html">File format converter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../support_status.html">Support Status</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Contributing Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../license.html">License</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Neural Network Libraries</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../../cpp.html">C++ API</a> &raquo;</li>
          <li><a href="../../doc.html">C++ API Document</a> &raquo;</li>
          <li><a href="../../cpp_api.html">NNABLA C++ API Document</a> &raquo;</li>
          <li><a href="../class.html">NNABLA Class</a> &raquo;</li>
      <li>class nbla::VirtualCachingAllocatorBase</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/cpp/Cpp/class/nbla--VirtualCachingAllocatorBase.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="class-nbla-virtualcachingallocatorbase">
<h1>class nbla::VirtualCachingAllocatorBase<a class="headerlink" href="#class-nbla-virtualcachingallocatorbase" title="Permalink to this headline"></a></h1>
<dl class="cpp class">
<dt class="sig sig-object cpp" id="_CPPv4N4nbla27VirtualCachingAllocatorBaseE">
<span id="_CPPv3N4nbla27VirtualCachingAllocatorBaseE"></span><span id="_CPPv2N4nbla27VirtualCachingAllocatorBaseE"></span><span id="nbla::VirtualCachingAllocatorBase"></span><span class="target" id="classnbla_1_1VirtualCachingAllocatorBase"></span><span class="k"><span class="pre">class</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">VirtualCachingAllocatorBase</span></span></span><span class="w"> </span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="k"><span class="pre">public</span></span><span class="w"> </span><a class="reference internal" href="../namespace/nbla.html#_CPPv44nbla" title="nbla"><span class="n"><span class="pre">nbla</span></span></a><span class="p"><span class="pre">::</span></span><a class="reference internal" href="nbla--Allocator.html#_CPPv4N4nbla9AllocatorE" title="nbla::Allocator"><span class="n"><span class="pre">Allocator</span></span></a><a class="headerlink" href="#_CPPv4N4nbla27VirtualCachingAllocatorBaseE" title="Permalink to this definition"></a><br /></dt>
<dd><p>A base class of <a class="reference internal" href="../namespace/nbla.html#classnbla_1_1VirtualCachingAllocator"><span class="std std-ref">VirtualCachingAllocator</span></a>. </p>
<p>This implements a virtual addressing logic and caching logic but it leaves an instantiation of <a class="reference internal" href="../namespace/nbla.html#classnbla_1_1Memory"><span class="std std-ref">Memory</span></a> class as a virtual function `VirtualCachingAllocatorBase::create_physical_memory_impl` and `VirtualCachingAllocatorBase::create_virtual_memory_impl`. It enables an easy realization of this allocator with any <a class="reference internal" href="../namespace/nbla.html#classnbla_1_1Memory"><span class="std std-ref">Memory</span></a> class implementation such as a pair of CudaVirtaulMemory and CudaPhysicalMemory.</p>
<p>Virtual addressing and caching logic is summarized as follows:</p>
<p>## Allocation When a memory is requested, this allocator combines multiple physical memories to map virtual memory whose size is enough for the request and returns mapped virtual address as Memeory instance. To reduce allocation overhead, cached virtual address and physical memory will be reused preferentially rather than newlly allocated. <a class="reference internal" href="../namespace/nbla.html#classnbla_1_1VirtualCachingAllocator"><span class="std std-ref">VirtualCachingAllocator</span></a> manages virtual and physical cache separately and reuses memory at both level (reusing virtual adrress without freeing and reserving is preferable in terms of allocation overhead).</p>
<p>## Caching and reusing virtual address When a memory is freed and returned to <a class="reference internal" href="../namespace/nbla.html#classnbla_1_1VirtualCachingAllocator"><span class="std std-ref">VirtualCachingAllocator</span></a>, returned virtual memory is cached for future memory request. Cached memories are reused in several ways depending on request as follows:<ul class="simple">
<li><p>case 1: No cached memory exists in cache -&gt; create new memory</p></li>
<li><p>case 2: A memory whose size is exactly the same as a request exists -&gt; just return this cached memory</p></li>
<li><p>case 3: At least one smaller memory than a request exists -&gt; grow this cached memory</p></li>
<li><p>case 4: Only larger memories exist -&gt; unbind smallest memories and create new virtual memory See implementation for the detail of how to release, reuse, unbind, and bind virtual and physical memory.</p></li>
</ul>
</p>
<p>## Free When a cached virtual memory is needed to be unbinded to move its physical memories to new virtual memory, the physical memories can be unbinded imediately. However, the virtual address have to be kept from being released until the device computation using this virtual address is finished, because device computation (e.g. CUDA) is fully asynchronous with host. This allocator keeps all virtual memories whose device_memory_state are DeviceMemoryState::Locked in waiting_list_. This waiting_list_ will be evaluated before every allocation request.</p>
<p>## Physical memory size and rounding Physical memory size is 20MB in default and mapped virtual memory will be rounded up by a multiple of 20MB (multiple of physical memory size). This memory size can be changed by VirtualCachingAllocatorBase::set_chunk_size. Larger size means faster allocation but larger fragmentation while smaller size means vice versa. Note that min and max size of a chunk depends on the device.</p>
<p><dl class="simple">
<dt><strong>See</strong></dt><dd><p><a class="reference internal" href="../namespace/nbla.html#classnbla_1_1VirtualCachingAllocatorBase"><span class="std std-ref">VirtualCachingAllocatorBase</span></a> </p>
</dd>
</dl>
</p>
<p>Subclassed by <a class="reference internal" href="../namespace/nbla.html#classnbla_1_1VirtualCachingAllocator"><span class="std std-ref">nbla::VirtualCachingAllocator&lt; PhysicalMemoryType, VirtualMemoryType &gt;</span></a></p>
</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="nbla--VirtualCachingAllocator.html" class="btn btn-neutral float-left" title="class nbla::VirtualCachingAllocator" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="nbla--WarpByFlow.html" class="btn btn-neutral float-right" title="class nbla::WarpByFlow" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017, Sony Corporation.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>